<html><head>
<!--jquery.filetree.tar_1.gz-->
<link rel="stylesheet" href="superfish-master/dist/css/superfish.css">
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="codemirror-5.1/lib/codemirror.css">
<link rel="stylesheet" href="codemirror-5.1/theme/rubyblue.css">
<link rel="stylesheet" href="codemirror-5.1/addon/hint/show-hint.css">
<link rel="stylesheet" href="codemirror-5.1/custom/match-highlight/match-highlight.css">


<link rel="stylesheet" href="jstree/themes/default/style.min.css" />



<!--THIS IS THE STYLE FOR THE TOOL BARS-->
<style> 

.toolBarItemTop { display: inline; }
#toolBarSide { display: inline; }
#leftBar { display: inline; }

</style>


<!--This is the style for the windows-->
<style>
/*#windowFormat { display: none; }*/
.windowPane { width: 600px; }

</style>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>


<script src="jstree/jstree.js"></script>


<script src="codemirror-5.1/lib/codemirror.js"></script>
<script src="codemirror-5.1/addon/selection/active-line.js"></script>
<script src="codemirror-5.1/addon/edit/matchbrackets.js"></script>
<script src="codemirror-5.1/mode/xml/xml.js"></script>
<script src="codemirror-5.1/mode/css/css.js"></script>
<script src="codemirror-5.1/mode/javascript/javascript.js"></script>
<script src="codemirror-5.1/mode/htmlmixed/htmlmixed.js"></script>
<script src="codemirror-5.1/addon/hint/show-hint.js"></script>
<script src="codemirror-5.1/addon/hint/xml-hint.js"></script>
<script src="codemirror-5.1/addon/hint/html-hint.js"></script>
<script src="codemirror-5.1/addon/search/searchcursor.js"></script>
<script src="codemirror-5.1/addon/search/match-highlighter.js"></script>

<script src="codemirror-5.1/custom/autocomplete/autocomplete.js"></script>

<style>
.jstree-contextmenu {
	z-index:99999;
}
</style>

<script src="superfish-master/dist/js/superfish.js"></script>




<script>
function customMenu(node) {
    // The default set of all items
    var items = {
		openItem: { //open with...
			label: "Open with...",
			action: false,
			submenu: {
				openWindows: {
					label: "Open in Pane 1",
					action: function () { alert("open file in window 1"); }
				},
				newWindow: {
					label: "Open in New Window Pane",
					action: function () { 
							var cloneCount = 1;
							$('#windowFormat')
								.clone()
								.attr('id', 'pane'+ cloneCount++)
								.appendTo("#windows")
							// $('#windowFormat')
							// 	.clone()
							//  .each(function() {
							//    $(this).attr(id, $(this).attr(id) + cloneCount++)
							//	})
							// 	.appendTo("#windows")
						
					}
				}
			}
		},
        renameItem: { // The "rename" menu item
            label: "Rename",
            action: function () { alert("Your new name is Milo."); }
        },
        deleteItem: { // The "delete" menu item
            label: "Delete",
            action: function () { alert("You have been deleted."); }
        }
    };

   if ($(node).hasClass("folder")) {
        // Delete the "delete" menu item
        delete items.deleteItem;
		alert("bam!");
    }

    return items;
}

</script>




<script>

  
$(function() {
    $( "ul.sf-menu" ).superfish();
  });

$(document).load(function() {

    $.ajax({
url: '/getFileStatus.php',
data: {
format: 'json'
},
success: function(data) {
console.log(data);
},
});
});

$(document).ready(function() {
$.fn.buildCodeMirror = function(){
	var cmOption = {
		lineNumbers: true,
		styleActiveLine: true,
		matchBrackets: true,
	};
	$('.textEditor').each(
		function() {
			console.log('Create new CodeMirror instance');
			var cm = CodeMirror.fromTextArea(this, {    
					lineNumbers: true,
					styleActiveLine: true,
					matchBrackets: true,
					ownerArea: this,
					mode: "text/html",
					highlightSelectionMatches: {showToken: /\w/},
					extraKeys: {
/*					  "'<'": completeAfter,
					  "'/'": completeIfAfterLt,
					  "' '": completeIfInTag,
					  "'='": completeIfInTag,*/
					  "Ctrl-Space": "autocomplete"
					},
					value: document.documentElement.innerHTML
				}
			);
			cm.on("change",$.fn.cmChange);
		}
	);
}

$.fn.cmChange = function(cm,change){
	var totalText = cm.getValue();
	var statusText = "Change type: " + change.origin + "";
	if (change.origin == "+input") {
		statusText += "@ " + change.to.line + ":" + change.to.ch + " text: ";
		if (change.text[0].length) {
			statusText += change.text;
		}
	}
	if (change.origin == "paste") {
		if (change.removed.length == 1 && change.removed[0].length == 0 && change.text.length == 1) {
			/* Simplest case */
			statusText += "@ " + change.to.line + ":" + change.to.ch + " text: ";
			if (change.text[0].length) {
				statusText += change.text;
			}
		}
		
	}
	if ((change.origin == "+delete" || change.origin == "cut")) {
		if (change.removed.length == 1) {
			/* This is a simple single line modification */
			var startPosition = change.to.ch - change.removed[0].length;
			var endPosition = change.to.ch;
			statusText += "@ " + change.to.line + ":" + startPosition + "-" + endPosition + " text: ";
			statusText += change.removed;
		}
		else {
			/* This is a multi-line delete/cut which needs to be handled differently */
		}
                
        }

        var statusBarInstance = cm.getOption('ownerArea').id;
	$('#statusBar_' + statusBarInstance).text(statusText);
	console.log('Attempting to update #statusBar_' + statusBarInstance + " to " + statusText);
//	console.log(change);
//	console.log(cm.getCursor());

}
$.fn.buildCodeMirror();



 
$('#jsTree1').jstree({

	"core" : {
       // so that create works
       check_callback : true,
       'data' : [
       {"id":"ftroot0","parent":"#","text":"Mockup","type":"root","li_attr":{"class":"jsTreeRoot"}},
       {"id":"ftfolder1","parent":"ftroot0","text":"server","type":"folder","li_attr":{"class":"jsTreeFolder"}},
       {"id":"ftfolder2","parent":"ftfolder1","text":"source","type":"folder","li_attr":{"class":"jsTreeFolder"}},
       {"id":"ftfile3","parent":"ftfolder2","text":"test.rb","type":"file","li_attr":{"class":"jsTreeFile"}},
       {"id":"ftfile4","parent":"ftfolder2","text":"server.rb","type":"file","li_attr":{"class":"jsTreeFile"}},
       {"id":"ftfile5","parent":"ftfolder2","text":"cProject.rb","type":"file","li_attr":{"class":"jsTreeFile"}},
       {"id":"ftfile6","parent":"ftfolder2","text":"cFileTree.rb","type":"file","li_attr":{"class":"jsTreeFile"}},
       {"id":"ftfile7","parent":"ftfolder2","text":"cDocument.rb","type":"file","li_attr":{"class":"jsTreeFile"}},
       {"id":"ftfolder8","parent":"ftroot0","text":"client","type":"folder","li_attr":{"class":"jsTreeFolder"}},
       {"id":"ftfolder9","parent":"ftfolder8","text":"html","type":"folder","li_attr":{"class":"jsTreeFolder"}},
       {"id":"ftfile10","parent":"ftfolder9","text":"testView.html","type":"file","li_attr":{"class":"jsTreeFile"}}
       ]

   },
   "dnd" : {
   	is_draggable : function(node) {

   		return true;
   	}
   },

   "types": {

   	"file" : {
   		"icon": "jstree-file",
   		"valid_children" : []
   	},
   	"folder" : {
   		"icon": "jstree-folder",
   		"valid_children" : ["file"]
   	},
   	"root" : {
   		"icon": "jstree-folder",
   		"valid_children" : ["file","folder"]
   	}


   },
   "plugins" : [ "contextmenu", "dnd", "crrm", "types" ], contextmenu: {items: customMenu}
});

$('#jsTree2').jstree({

	"core" : {
       // so that create works
       check_callback : true,
       'data' : [
       {"id":"chatroot","parent":"#","text":"Chat Rooms","type":"root","li_attr":{"class":"jsRoot"}},{"id":"chat1","parent":"chatroot","text":"StdDev","type":"chat","li_attr":{"class":"jsChat"}},{"id":"chat2","parent":"chatroot","text":"Java","type":"chat","li_attr":{"class":"jsChat"}},{"id":"chat3","parent":"chatroot","text":"Coffee","type":"chat","li_attr":{"class":"jsChat"}},{"id":"chat4","parent":"chatroot","text":"3rd shift rulez","type":"chat","li_attr":{"class":"jsChat"}}]
       

   },
   "dnd" : {
   	is_draggable : function(node) {

   		return true;
   	}
   },

   "types": {

   	"chat" : {
   		"icon": "jstree-chat",
   		"valid_children" : []
   	},
   	"root" : {
   		"icon": "jstree-folder",
   		"valid_children" : ["chat"]
   	}


   },
   "plugins" : [ "contextmenu", "dnd", "crrm", "types" ], contextmenu: {items: customMenu}
});


  $('.drag')
    .on('mousedown', function (e) {
                return $.vakata.dnd.start(e, { 'jstree' : true, 'obj' : $(this), 'nodes' : [{ id : true, text: $(this).text() }] }, '<div id="jstree-dnd" class="jstree-default"><i class="jstree-icon jstree-er"></i>' + $(this).text() + '</div>');
            });
        $(document)
            .on('dnd_move.vakata', function (e, data) {
                var t = $(data.event.target);
                if(!t.closest('.jstree').length) {
                    if(t.closest('.menuList').length) {

						if ($("#" + data.data.obj[0].id).hasClass("jsTreeFile")) {
						
							data.helper.find('.jstree-icon').removeClass('jstree-er').addClass('jstree-ok');
						}
						else {
							data.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');
						}
                    }
                    else {
                        data.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');
                    }
                }
            })
            .on('dnd_stop.vakata', function (e, data) {
                var t = $(data.event.target);
                if(!t.closest('.jstree').length) {
                    if(t.closest('.menuList').length) {
 
						
						
						if ($("#" + data.data.obj[0].id).hasClass("jsTreeFile")) {
						console.log("TARGET");
						console.log(data.event.target);
						console.log("ID");
						var thisParent = $(data.event.target).closest('div').attr('id');

							if ($("#" + thisParent).find('li.' + data.data.obj[0].id).length) { //the tab already exists 
								var listItem = $("#" + thisParent).find('li.' + data.data.obj[0].id);
								$( "#" + thisParent ).tabs( "option", "active", listItem.index() ); //set the active tab to the file they dragged in
							}
							else {
								console.log(data);
								console.log($("#" + data.data.obj[0].id));
								console.log($("#" + data.data.obj[0].id).closest('li').attr('srcPath'));
								console.log("Dragged " + data.element.outerText + " to " + data.event.target);
								var tabCounter = newTab(data.element.text,t.closest('div').attr('id'),data.data.obj[0].id);
								var tabItem = $( "#tabs-" + tabCounter );
								var itemParent = tabItem.closest('div').attr('id');
								
							}
						}
                    }
                }
            });
  
});



</script>


  
  <script>
      $(function () {
          $("#editorContextWindow01").menu({
              select: function (event, ui) {
                  $("#editorContextWindow01").hide();
                  alert("Menu element clicked!");
              }
          });

          $(".windowPane").on("contextmenu", function (event) {
              $("#editorContextWindow01").show();
              $("#editorContextWindow01").position({
                  collision: "none",
                  my: "left top",
                  of: event
              });
              console.log(event);

              return false;
          });

          $(document).click(function (event) {
              $("#editorContextWindow01").hide();
          });

          $("#editorContextWindow01").on("contextmenu", function (event) { return false; });
      });

  </script>
  <style>
  .ui-menu { width: 150px; }
   #editorContextWindow01 { position:absolute; display:none; }
  </style>
  
  
   <style>
#dialog label, #dialog input { display:block; }
#dialog label { margin-top: 0.5em; }
#dialog input, #dialog textarea { width: 95%; }
.tabBar { margin-top: 1em; }
.tabBar li .ui-icon-close { float:right; margin: 0.4em 0.2em 0 0; cursor: pointer; }
#add_tab { cursor: pointer; }
</style>
<script>
function newTab(filename,paneId,originId) {
		var tabs = $( ".tabBar" ).tabs();
		var tabTitle = $( "#tab_title" ),
				tabContent = $( "#tab_content" ),
				tabTemplate = "<li class='#{class}'><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close closeTab' role='presentation'>Remove Tab</span></li>";
		var tabCounter = $("#" + paneId + ' .menuList li').length;
		tabCounter = tabCounter + 1;
		console.log("PANEID = " + paneId + " TABCOUNTER = " + tabCounter + "\n");

		var label = filename,
			id = "tabs-" + tabCounter,
			li = $( tabTemplate.replace( /#\{href\}/g, "#" + id ).replace( /#\{label\}/g, label ).replace( /#\{class\}/g, originId ) ),
			tabContentHtml = "<textarea>CODEMIRROR-GOES-HERE</textarea>";
		tabs.find( ".ui-tabs-nav" ).append( li );
		tabs.append( "<div id='" + id + "'><p>" + tabContentHtml + "</p></div>" );
		tabs.tabs( "refresh" );
		return(tabCounter);
		
}

$(function() {



	var tabTitle = $( "#tab_title" ),
		tabContent = $( "#tab_content" ),
		tabTemplate = "<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close closeTab' role='presentation'>Remove Tab</span></li>",
		tabCounter = 2;
	var tabs = $( ".tabBar" ).tabs();
	$( ".tabBar ul" ).sortable();
	// modal dialog init: custom buttons and a "close" callback resetting the form inside
	var dialog = $( "#dialog" ).dialog({
		autoOpen: false,
		modal: true,
		buttons: {
			Add: function() {
				addTab();
				$( this ).dialog( "close" );
			},
			Cancel: function() {
				$( this ).dialog( "close" );
			}
		},
		close: function() {
			form[ 0 ].reset();
		}
	});
	// addTab form: calls addTab function on submit and closes the dialog
	var form = dialog.find( "form" ).submit(function( event ) {
		addTab();
		dialog.dialog( "close" );
		event.preventDefault();
	});
	// actual addTab function: adds new tab using the input from the form above
	function addTab() {
		var label = tabTitle.val() || "Tab " + tabCounter,
			id = "tabs-" + tabCounter,
			li = $( tabTemplate.replace( /#\{href\}/g, "#" + id ).replace( /#\{label\}/g, label ) ),
		tabContentHtml = tabContent.val() || "Tab " + tabCounter + " content.";
		tabs.find( ".ui-tabs-nav" ).append( li );
		tabs.append( "<div id='" + id + "'><p>" + tabContentHtml + "</p></div>" );
		tabs.tabs( "refresh" );
		tabCounter++;
	}
	// addTab button: just opens the dialog
	$( "#add_tab" )
		.button()
		.click(function() {
			dialog.dialog( "open" );
	});
	// close icon: removing the tab on click
	tabs.delegate( "span.ui-icon-close", "click", function() {
		var panelId = $( this ).closest( "li" ).remove().attr( "aria-controls" );
			$( "#" + panelId ).remove();
			tabs.tabs( "refresh" );
		});
	tabs.bind( "keyup", function( event ) {
		if ( event.altKey && event.keyCode === $.ui.keyCode.BACKSPACE ) {
			var panelId = tabs.find( ".ui-tabs-active" ).remove().attr( "aria-controls" );
				$( "#" + panelId ).remove();
				tabs.tabs( "refresh" );
		}
	});
});
</script>




  
</head>
<body>
<div id="mainContainer">
        <div id="topBar">
                <div id="menuBar">
                        <ul id="menu1" class="sf-menu">
                                <li class="current"> <a href="#">File</a>
                                        <ul>
                                                <li><a href="#">Commit</a></li>
                                                <li><a href="#">Export</a></li>
                                        </ul>
                                </li>
                                <li class="current"><a href="#">VCS</a>
                                                <ul>
                                                <li><a href="#">View Revisions</a></li>
                                                <li><a href="#">Revert Commits</a></li>
                                        </ul>
                                </li>
                        </ul>
                </div>
                <div style="clear:both;"></div>
                <div id="toolBarTop">
                        <div class="toolBarItemTop">[button]</div>
                        <div class="toolBarItemTop">[button]</div>
                        <div class="toolBarItemTop">[button]</div>
                </div>
                <div style="clear:both;"></div>
        </div>

        <div id="editorContainer">
                <div id="bottomWindow">
                        <div id="leftBar">
                                <div id="toolBarSide">
                                        <div class="toolBarItemSide">[button]</div>
                                        <div class="toolBarItemSide">[button]</div>
                                        <div class="toolBarItemSide">[button]</div>
                                </div>
                                <div id="fileContainer">
									<div id="jsTree1">
										<ul>
											<li srcPath="/">Mockup Project
												<ul>
													<li srcPath="/Source" class="folder">Source
														<ul>
															<!--<li srcPath="/Source/uiTest.html" class="fileIcon" data-jstree='{"icon":"jstree-file","type":"file"}'>uiTest.html</li>
															<li srcPath="/Source/testFile.php" class="fileIcon" data-jstree='{"icon":"jstree-file","type":"file"}'>testFile.php</li>
															-->
														</ul>
													</li>
												</ul>
											</li>
										</ul>
									</div>
									<div id="jsTree2">
										<ul>
											<li srcPath="/">Mockup Project
												<ul>
													<li srcPath="/Source" class="folder">Source
														<ul>
															<!--<li srcPath="/Source/uiTest.html" class="fileIcon" data-jstree='{"icon":"jstree-file","type":"file"}'>uiTest.html</li>
															<li srcPath="/Source/testFile.php" class="fileIcon" data-jstree='{"icon":"jstree-file","type":"file"}'>testFile.php</li>
															-->
														</ul>
													</li>
												</ul>
											</li>
										</ul>
									</div>

								</div>
                                <div style="border:0px;clear:both;"></div>

                        </div>

                        <div id="rightWindow">
							<div id="dialog" title="Tab data">
								<form>
									<fieldset class="ui-helper-reset">
									<label for="tab_title">Title</label>
									<input type="text" name="tab_title" id="tab_title" value="Tab Title" class="ui-widget-content ui-corner-all"/>
									<label for="tab_content">Content</label>
									<textarea name="tab_content" id="tab_content" class="ui-widget-content ui-corner-all">Tab content</textarea>
									</fieldset>
								</form>
							</div>
							<div id="windows">
								<div id="windowFormat" class="windowPane">
									<div id="tabBar01" class="tabBar">

										  <ul class="menuList jstree-drop">
											<!--<li id="add_tab"><span class="ui-icon ui-icon-folder-open"></span></li>-->
											<li id="tab0101"><a href="#tabs-1">Tab01</a><span class="ui-icon ui-icon-close" role="presentation">Remove Tab</span></li>
											<li id="tab0102"><a href="#tabs-2">Tab02</a><span class="ui-icon ui-icon-close" role="presentation">Remove Tab</span></li>
										  </ul>
										
										<div id="tabs-1">


									
											<div class="editorWindow">
												<textarea id="textEditor01" class="textEditor" style="width:100%;height:100%;">&lt;strong&gt;bold text&lt;/strong&gt;

											
												</textarea>
												<div id="statusBar_textEditor01" class="statusBar">There should be status info here</div>
											</div>
											
											
											<ul id="editorContextWindow01" class="editorContextMenu">
												
												<li><span class="ui-icon ui-icon-undo"></span>Undo</li>
												<li><span class="ui-icon ui-icon-redo"></span>Redo</li>
												<li><span class="ui-icon ui-icon-cut"></span>Cut</li>
												<li><span class="ui-icon ui-icon-copy"></span>Copy</li>
												<li><span class="ui-icon ui-icon-paste"></span>Paste</li>
												<li>
													Find...
													<ul>
														<li><span class="ui-icon ui-icon-search"></span>Find in File</li>
														<li><span class="ui-icon ui-icon-zoomin"></span>Find in All Files</li>
														<li><span class="ui-icon ui-icon-wrench"></span>Find and Replace</li>
														
													</ul>
												</li>
												
											
											</ul>
										</div>
										<div id="tabs-2">


									
											<div class="editorWindow">
												<textarea id="textEditor02" class="textEditor" style="width:100%;height:100%;">&lt;strong&gt;bold text&lt;/strong&gt;

											
												</textarea>
												<div id="statusBar_textEditor02" class="statusBar">There should be status info here</div>
											</div>
											
											
											
										</div>

									</div>
								
								</div>
							</div>
							
							
							
							<!-- <div class="windowRowClear"> </div> This clears the float and puts windows on the next line-->
							
						
						
						
						
                        <div style="clear:both;"></div>
                </div>
        </div>
</div>

<div id="log"> </div>
</body></html>
